<!-- Keycloak Standalone Configuration with Kafka Event Listener -->
<!-- This is a partial configuration showing only the event listener SPI section -->
<!-- Add this to your standalone.xml or standalone-ha.xml -->

<spi name="eventsListener">
    <provider name="kafka-event-listener" enabled="true">
        <properties>
            <!-- Kafka Connection -->
            <property name="bootstrapServers" value="localhost:9092"/>
            <property name="eventTopic" value="keycloak-events"/>
            <property name="adminEventTopic" value="keycloak-admin-events"/>
            <property name="clientId" value="keycloak-event-listener"/>

            <!-- Event Filtering -->
            <property name="enableUserEvents" value="true"/>
            <property name="enableAdminEvents" value="true"/>
            <property name="includedEventTypes" value=""/>

            <!-- Circuit Breaker -->
            <property name="enableCircuitBreaker" value="true"/>
            <property name="circuitBreakerFailureThreshold" value="5"/>
            <property name="circuitBreakerOpenTimeoutSeconds" value="60"/>

            <!-- Retry Policy -->
            <property name="enableRetry" value="true"/>
            <property name="maxRetryAttempts" value="3"/>
            <property name="retryInitialDelayMs" value="100"/>
            <property name="retryMaxDelayMs" value="10000"/>

            <!-- Dead Letter Queue -->
            <property name="enableDeadLetterQueue" value="true"/>
            <property name="dlqMaxSize" value="10000"/>
            <property name="dlqPersistToFile" value="true"/>
            <property name="dlqPath" value="./dlq/kafka"/>

            <!-- Batch Processing (optional, for high volume) -->
            <property name="enableBatching" value="false"/>
            <property name="batchSize" value="100"/>
            <property name="batchFlushIntervalMs" value="5000"/>

            <!-- Prometheus Metrics -->
            <property name="enablePrometheus" value="true"/>
            <property name="prometheusPort" value="9090"/>
            <property name="enableJvmMetrics" value="true"/>
        </properties>
    </provider>
</spi>
