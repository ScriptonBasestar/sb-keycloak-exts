metering {
  storage {
    # Storage backend type: influxdb, timescaledb
    type = "influxdb"
    type = ${?METERING_STORAGE_TYPE}
  }

  kafka {
    bootstrap-servers = "localhost:9092"
    bootstrap-servers = ${?KAFKA_BOOTSTRAP_SERVERS}

    event-topic = "keycloak.events"
    event-topic = ${?KAFKA_EVENT_TOPIC}

    admin-event-topic = "keycloak.admin.events"
    admin-event-topic = ${?KAFKA_ADMIN_EVENT_TOPIC}

    group-id = "keycloak-metering-service"
    group-id = ${?KAFKA_GROUP_ID}

    # Start from earliest if no offset exists
    auto-offset-reset = "earliest"
    auto-offset-reset = ${?KAFKA_AUTO_OFFSET_RESET}

    # Manual commit for better control
    enable-auto-commit = false

    # Batch size for polling
    max-poll-records = 500
    max-poll-records = ${?KAFKA_MAX_POLL_RECORDS}
  }

  influxdb {
    url = "http://localhost:8086"
    url = ${?INFLUXDB_URL}

    database = "keycloak_metrics"
    database = ${?INFLUXDB_DATABASE}

    # Optional authentication
    username = ${?INFLUXDB_USERNAME}
    password = ${?INFLUXDB_PASSWORD}

    # Retention policy (default: autogen - infinite retention)
    retention-policy = "autogen"
    retention-policy = ${?INFLUXDB_RETENTION_POLICY}

    # Batch processing
    batch-size = 1000
    batch-size = ${?INFLUXDB_BATCH_SIZE}

    flush-interval-ms = 5000
    flush-interval-ms = ${?INFLUXDB_FLUSH_INTERVAL_MS}
  }

  # TimescaleDB configuration (future)
  timescaledb {
    host = "localhost"
    host = ${?TIMESCALEDB_HOST}

    port = 5432
    port = ${?TIMESCALEDB_PORT}

    database = "keycloak_metrics"
    database = ${?TIMESCALEDB_DATABASE}

    username = "postgres"
    username = ${?TIMESCALEDB_USERNAME}

    password = "postgres"
    password = ${?TIMESCALEDB_PASSWORD}
  }

  prometheus {
    port = 9091
    port = ${?PROMETHEUS_PORT}
  }
}
