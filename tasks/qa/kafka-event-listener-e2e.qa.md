# title: Kafka Event Listener 종단간 테스트 시나리오

## related_tasks
- /tasks/done/kafka-event-listener-enhancement.md
- /tasks/done/kafka-event-listener-tasks__DONE_20250717.md

## purpose
Kafka Event Listener가 실제 프로덕션 환경에서 안정적으로 동작하는지 종단간 테스트

## scenario

### 1. 기본 이벤트 발행 테스트
1. **Keycloak 설정 및 연결**
   - Keycloak 관리자 콘솔에서 Event Listener 활성화
   - Kafka 브로커 연결 설정 (bootstrap.servers)
   - 토픽 설정 (user-events, admin-events)
   - 연결 상태 확인

2. **사용자 이벤트 발행**
   - 사용자 로그인 → Kafka 메시지 확인
   - 사용자 로그아웃 → Kafka 메시지 확인
   - 사용자 등록 → Kafka 메시지 확인
   - 패스워드 변경 → Kafka 메시지 확인

3. **관리자 이벤트 발행**
   - 사용자 생성 → admin-events 토픽 확인
   - 사용자 삭제 → admin-events 토픽 확인
   - 권한 변경 → admin-events 토픽 확인
   - 설정 변경 → admin-events 토픽 확인

### 2. 메트릭 수집 및 모니터링 테스트
1. **Prometheus 메트릭 확인**
   - /metrics 엔드포인트 접근
   - 이벤트 처리량 메트릭 확인
   - 에러율 메트릭 확인
   - 지연시간 메트릭 확인

2. **Grafana 대시보드 검증**
   - 실시간 메트릭 시각화 확인
   - 임계값 설정 및 알람 테스트
   - 히스토리컬 데이터 조회
   - 대시보드 필터링 기능

3. **시스템 리소스 모니터링**
   - CPU 사용률 모니터링
   - 메모리 사용량 추적
   - Kafka 연결 상태 모니터링
   - 백로그 모니터링

### 3. 장애 대응 및 복구 테스트
1. **Kafka 연결 장애 시뮬레이션**
   - Kafka 브로커 중단
   - 자동 재연결 메커니즘 확인
   - Circuit Breaker 동작 확인
   - 장애 복구 후 정상 동작 확인

2. **백프레셔 상황 테스트**
   - 대량 이벤트 발생 시뮬레이션
   - 백프레셔 감지 및 대응
   - 메모리 사용량 모니터링
   - 시스템 안정성 확인

3. **알림 시스템 테스트**
   - 임계값 초과 시 알림 발생
   - 알림 전송 채널 확인
   - 장애 해결 후 알림 해제
   - 에스컬레이션 절차 확인

### 4. 성능 및 부하 테스트
1. **처리량 테스트**
   - 초당 1000개 이벤트 처리 확인
   - 배치 처리 성능 측정
   - 압축 효과 확인
   - 메모리 사용량 최적화 확인

2. **동시성 테스트**
   - 다중 사용자 동시 로그인
   - 동시 관리자 작업 수행
   - 이벤트 순서 보장 확인
   - 데이터 일관성 검증

3. **지연시간 테스트**
   - 이벤트 발생부터 Kafka 도착까지 지연시간
   - 네트워크 지연 시뮬레이션
   - 재시도 메커니즘 성능 확인
   - 백오프 전략 검증

## expected_result
- **기본 기능**: 모든 Keycloak 이벤트가 정확히 Kafka로 전송
- **메트릭**: Prometheus 메트릭이 정상 수집되고 Grafana에서 시각화
- **장애 대응**: 장애 상황에서 자동 복구 및 알림 시스템 정상 동작
- **성능**: 초당 1000개 이벤트 처리 및 99.9% 가용성 달성
- **모니터링**: 시스템 리소스 사용률이 안정적으로 유지
- **데이터 형식**: JSON 형태로 일관된 데이터 구조 유지
- **보안**: 민감 정보 노출 없이 안전한 이벤트 전송

## tags
[qa], [e2e], [kafka], [monitoring], [performance], [manual]